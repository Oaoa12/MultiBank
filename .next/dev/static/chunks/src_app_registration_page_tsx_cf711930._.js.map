{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/%D0%A0%D1%83%D1%81%D0%BB%D0%B0%D0%BD/Desktop/%D0%9F%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D1%8B/multibank-frontend/src/app/registration/page.tsx"],"sourcesContent":["\"use client\"\r\nimport { Anchor, Button, Center, Container, Group, Paper, PasswordInput, Select, Stack, Stepper, Text, TextInput, Title } from \"@mantine/core\";\r\nimport { notifications } from '@mantine/notifications';\r\nimport { IconAt, IconCalendar, IconPhone, IconUser, IconUserCheck } from '@tabler/icons-react';\r\nimport { useLoginMutation, useRegisterMutation } from '@/lib/store/api/AuthApi';\r\nimport { useUpdateProfileAuthorizedMutation, useUpdateProfileMutation, useUpdateUserAuthorizedMutation, useUpdateUserMutation } from '@/lib/store/api/UserApi';\r\nimport Link from 'next/link';\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useGetCurrentUserQuery } from '@/lib/store/api/UserApi';\r\n\r\nexport default function Registration() {\r\n  const router = useRouter();\r\n  const [active, setActive] = useState(0);\r\n\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [username, setUsername] = useState('');\r\n  const [phone, setPhone] = useState('');\r\n\r\n  const [firstName, setFirstName] = useState('');\r\n  const [lastName, setLastName] = useState('');\r\n  const [birthDate, setBirthDate] = useState<string>('');\r\n  const [gender, setGender] = useState<'MALE' | 'FEMALE' | ''>('');\r\n\r\n  const [tempToken, setTempToken] = useState<string | null>(null);\r\n  const [register, { isLoading: isRegisterLoading }] = useRegisterMutation();\r\n  const [login] = useLoginMutation();\r\n  const [updateUser, { isLoading: isUpdateUserLoading }] = useUpdateUserMutation();\r\n  const [updateUserAuthorized] = useUpdateUserAuthorizedMutation();\r\n  const [updateProfile, { isLoading: isUpdateProfileLoading }] = useUpdateProfileMutation();\r\n  const [updateProfileAuthorized] = useUpdateProfileAuthorizedMutation();\r\n  const { isSuccess } = useGetCurrentUserQuery();\r\n  const checkedMountRedirect = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (!checkedMountRedirect.current) {\r\n      checkedMountRedirect.current = true;\r\n      if (isSuccess) {\r\n        router.replace('/dashboard');\r\n      }\r\n    }\r\n  }, [router]);\r\n\r\n  const handleStep1 = async () => {\r\n    if (!email || !password) {\r\n      notifications.show({ color: 'red', title: 'Заполните поля', message: 'Почта и пароль обязательны' });\r\n      return;\r\n    }\r\n    try {\r\n      const reg = await register({ email, password }).unwrap();\r\n      const token = reg?.access_token;\r\n      if (token) setTempToken(token);\r\n      try {\r\n        await login({ email, password }).unwrap();\r\n      } catch {}\r\n      if (username || phone) {\r\n        if (token) {\r\n          await updateUserAuthorized({ data: { username: username || undefined, phone: phone || undefined }, accessToken: token }).unwrap();\r\n        } else {\r\n          await updateUser({ username: username || undefined, phone: phone || undefined }).unwrap();\r\n        }\r\n      }\r\n      setActive(1);\r\n      notifications.show({ color: 'green', title: 'Шаг 1 выполнен', message: 'Аккаунт создан' });\r\n    } catch (error: any) {\r\n      notifications.show({ color: 'red', title: 'Ошибка регистрации', message: error?.data?.message || 'Попробуйте ещё раз' });\r\n    }\r\n  };\r\n\r\n  const handleFinish = async () => {\r\n    try {\r\n      const body = {\r\n        firstName: firstName || undefined,\r\n        lastName: lastName || undefined,\r\n        gender: (gender as any) || undefined,\r\n        birthDate: birthDate ? new Date(birthDate).toISOString() : undefined,\r\n      };\r\n      if (tempToken) {\r\n        await updateProfileAuthorized({ data: body, accessToken: tempToken }).unwrap();\r\n      } else {\r\n        await updateProfile(body).unwrap();\r\n      }\r\n      notifications.show({ color: 'green', title: 'Готово', message: 'Профиль заполнен' });\r\n      router.replace('/dashboard');\r\n    } catch (error: any) {\r\n      notifications.show({ color: 'red', title: 'Ошибка профиля', message: error?.data?.message || 'Попробуйте ещё раз' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Center h={\"100dvh\"} style={{ background: 'linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%)' }}>\r\n      <Container size={520}>\r\n        <Paper shadow=\"lg\" radius=\"md\" p=\"xl\" withBorder bg=\"white\">\r\n          <Stack>\r\n            <Title order={2} c=\"#1e3a8a\" ta=\"center\">Регистрация Multibank</Title>\r\n            <Text size=\"sm\" c=\"dimmed\" ta=\"center\">2 шага: пользователь → профиль</Text>\r\n\r\n            <Stepper active={active} allowNextStepsSelect={false}\r\n              color=\"#1e3a8a\"\r\n            >\r\n              <Stepper.Step icon={<IconUser size={18} />} label=\"Пользователь\" description=\"Данные аккаунта\">\r\n                <Stack>\r\n                  <TextInput\r\n                    label=\"Почта\"\r\n                    placeholder=\"ivanov@mail.ru\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    leftSection={<IconAt size={18} />}\r\n                    required\r\n                  />\r\n                  <PasswordInput\r\n                    label=\"Пароль\"\r\n                    placeholder=\"Придумайте надёжный пароль\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    required\r\n                  />\r\n                  <TextInput\r\n                    label=\"Имя пользователя (ник)\"\r\n                    placeholder=\"username\"\r\n                    value={username}\r\n                    onChange={(e) => setUsername(e.target.value)}\r\n                    leftSection={<IconUserCheck size={18} />}\r\n                  />\r\n                  <TextInput\r\n                    label=\"Телефон\"\r\n                    placeholder=\"+7-999-123-45-67\"\r\n                    value={phone}\r\n                    onChange={(e) => setPhone(e.target.value)}\r\n                    leftSection={<IconPhone size={18} />}\r\n                  />\r\n                  <Group justify=\"space-between\">\r\n                    <Anchor component={Link} href=\"/login\" size=\"sm\" c=\"#1e3a8a\">У меня уже есть аккаунт</Anchor>\r\n                    <Button onClick={handleStep1} loading={isRegisterLoading || isUpdateUserLoading}\r\n                      variant=\"gradient\" gradient={{ from: '#1e3a8a', to: '#3b82f6' }} radius=\"md\"\r\n                    >Далее</Button>\r\n                  </Group>\r\n                </Stack>\r\n              </Stepper.Step>\r\n              <Stepper.Step icon={<IconCalendar size={18} />} label=\"Профиль\" description=\"О себе\">\r\n                <Stack>\r\n                  <TextInput\r\n                    label=\"Имя\"\r\n                    placeholder=\"Иван\"\r\n                    value={firstName}\r\n                    onChange={(e) => setFirstName(e.target.value)}\r\n                  />\r\n                  <TextInput\r\n                    label=\"Фамилия\"\r\n                    placeholder=\"Иванов\"\r\n                    value={lastName}\r\n                    onChange={(e) => setLastName(e.target.value)}\r\n                  />\r\n                  <TextInput\r\n                    label=\"Дата рождения\"\r\n                    type=\"date\"\r\n                    value={birthDate}\r\n                    onChange={(e) => setBirthDate(e.target.value)}\r\n                  />\r\n                  <Select\r\n                    label=\"Пол\"\r\n                    placeholder=\"Выберите\"\r\n                    data={[\r\n                      { value: 'MALE', label: 'Мужской' },\r\n                      { value: 'FEMALE', label: 'Женский' },\r\n                    ]}\r\n                    value={gender}\r\n                    onChange={(v) => setGender((v as any) || '')}\r\n                  />\r\n                  <Group justify=\"space-between\">\r\n                    <Button variant=\"default\" onClick={() => setActive(0)}>Назад</Button>\r\n                    <Button onClick={handleFinish} loading={isUpdateProfileLoading}\r\n                      variant=\"gradient\" gradient={{ from: '#1e3a8a', to: '#3b82f6' }} radius=\"md\"\r\n                    >Завершить</Button>\r\n                  </Group>\r\n                </Stack>\r\n              </Stepper.Step>\r\n              <Stepper.Completed>\r\n                <Text ta=\"center\">Готово!</Text>\r\n              </Stepper.Completed>\r\n            </Stepper>\r\n\r\n          </Stack>\r\n        </Paper>\r\n      </Container>\r\n    </Center>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}